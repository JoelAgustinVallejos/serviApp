<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Login - Sistema de Turnos</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
    <h2>ğŸ” Iniciar sesiÃ³n</h2>
    <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="ContraseÃ±a" required />
        <button type="submit">Entrar</button>
    </form>
    <p id="mensaje"></p>

    <script>
        const form = document.getElementById("loginForm");
        const mensaje = document.getElementById("mensaje");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                const res = await fetch("http://localhost:3000/users/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();

                if (!res.ok) {
                    mensaje.style.color = "red";
                    mensaje.textContent = data.error;
                    return;
                }

                localStorage.setItem("usuario", JSON.stringify(data.user));
                mensaje.style.color = "green";
                mensaje.textContent = "Login correcto âœ”ï¸";

                setTimeout(() => {
                    // Redirige a archivos en la misma carpeta 'views'
                    window.location.href = data.user.rol.trim().toLowerCase() === "admin" ? "admin.html" : "turnos.html";
                }, 1000);
            } catch {
                mensaje.textContent = "âŒ Error de servidor";
            }
        });
    </script>
</body>
</html>