<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Turnos</title>
    <link rel="stylesheet" href="/assets/css/login.css">
</head>
<div class="wrapper">
    <div class="item1">

      <h3>LOGIN</h3>

        <form id="loginForm">
          <label for="email"> Email  </label>
          <input type="email" id="email" name="email" placeholder="Ingrese email.." required>
      
          <label for="password">  Contraseña  </label>
          <input type="password" id="password" name="password" placeholder="Ingrese contraseña.." required>
      
          <input type="submit" value="Enviar">
        </form>
    </div> 
  </div>
    <p id="mensaje"></p>
    <script>
        const form = document.getElementById("loginForm");
        const mensaje = document.getElementById("mensaje");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                const res = await fetch("http://localhost:3000/users/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();

                if (!res.ok) {
                    mensaje.style.color = "red";
                    mensaje.textContent = data.error;
                    return;
                }

                localStorage.setItem("usuario", JSON.stringify(data.user));
                mensaje.style.color = "green";
                mensaje.textContent = "Login correcto ✔️";

                setTimeout(() => {
                    window.location.href = data.user.rol.trim().toLowerCase() === "admin" ? "admin.html" : "turnos.html";
                }, 1000);
            } catch {
                mensaje.textContent = "❌ Error de servidor";
            }
        });
    </script>
</body>
</html>